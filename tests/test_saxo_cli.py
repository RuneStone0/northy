
def test_cli_saxo_report_closed_positions():
    """
        Test cases TODO:
            - Test with no data
            - when now hour is 23, 0, 1, 17
            - when now day is 1,3,5,6
            - when now closed trades is 0, skip sending email
            - make sure now is set to US Central timezone
    """
    # Sample data returned by SaxoTrader.Saxo.positions()
    data = [
        {'__count': 5, 'Data': [{'NetPositionId': '4913__CfdOnIndex', 'PositionBase': {'AccountId': '17470793', 'AccountKey': 'wlgQxI5-JzdhnV4s6BsDiA==', 'Amount': -20.0, 'AssetType': 'CfdOnIndex', 'CanBeClosed': False, 'ClientId': '17470793', 'CloseConversionRateSettled': False, 'CorrelationKey': 'a5e5174e-b2e6-43b6-bdbd-e8d90c85ec3b', 'CorrelationTypes': [], 'ExecutionTimeClose': '2023-07-30T23:59:34.804356Z', 'ExecutionTimeOpen': '2023-08-15T00:35:30.328725Z', 'IsForceOpen': False, 'IsMarketOpen': True, 'LockedByBackOffice': False, 'OpenPrice': 4494.14, 'OpenPriceIncludingCosts': 4494.14, 'RelatedOpenOrders': [], 'RelatedPositionId': '5016310795', 'SourceOrderId': '5014636405', 'Status': 'Closed', 'Uic': 4913, 'ValueDate': '2023-08-15T00:00:00.000000Z'}, 'PositionId': '5016489308', 'PositionView': {'CalculationReliability': 'ApproximatedPrice', 'ConversionRateClose': 0.91704, 'ConversionRateOpen': 0.91704, 'CurrentPrice': 0.0, 'CurrentPriceDelayMinutes': 15, 'CurrentPriceType': 'None', 'ExposureCurrency': 'USD', 'InstrumentPriceDayPercentChange': 0.0, 'MarketState': 'Open', 'MarketValue': 0.0, 'ProfitLossOnTrade': -1856.8, 'ProfitLossOnTradeInBaseCurrency': -1702.76, 'TradeCostsTotal': 0.0, 'TradeCostsTotalInBaseCurrency': 0.0, 'UnderlyingCurrentPrice': 0.0, 'ProfitLossOnTradeAdjusted': 5.6}}, {'NetPositionId': '4913__CfdOnIndex', 'PositionBase': {'AccountId': '17470793', 'AccountKey': 'wlgQxI5-JzdhnV4s6BsDiA==', 'Amount': 20.0, 'AssetType': 'CfdOnIndex', 'CanBeClosed': False, 'ClientId': '17470793', 'CloseConversionRateSettled': False, 'CorrelationKey': 'a5e5174e-b2e6-43b6-bdbd-e8d90c85ec3b', 'ExecutionTimeClose': '2023-08-15T00:35:30.328725Z', 'ExecutionTimeOpen': '2023-07-30T23:59:34.804356Z', 'IsForceOpen': False, 'IsMarketOpen': True, 'LockedByBackOffice': False, 'OpenPrice': 4586.98, 'OpenPriceIncludingCosts': 4586.98, 'RelatedOpenOrders': [], 'RelatedPositionId': '5016489308', 'SourceOrderId': '5014386349', 'Status': 'Closed', 'Uic': 4913, 'ValueDate': '2023-07-31T00:00:00.000000Z'}, 'PositionId': '5016310795', 'PositionView': {'CalculationReliability': 'ApproximatedPrice', 'ConversionRateClose': 0.91704, 'ConversionRateOpen': 0.909335, 'CurrentPrice': 0.0, 'CurrentPriceDelayMinutes': 15, 'CurrentPriceType': 'None', 'ExposureCurrency': 'USD', 'InstrumentPriceDayPercentChange': 0.0, 'MarketState': 'Open', 'MarketValue': 0.0, 'ProfitLossOnTrade': -1856.8, 'ProfitLossOnTradeInBaseCurrency': -1702.76, 'TradeCostsTotal': 0.0, 'TradeCostsTotalInBaseCurrency': 0.0, 'UnderlyingCurrentPrice': 0.0, 'ProfitLossOnTradeAdjusted': -1862.8}}, {'NetPositionId': '4912__CfdOnIndex', 'PositionBase': {'AccountId': '17470793', 'AccountKey': 'wlgQxI5-JzdhnV4s6BsDiA==', 'Amount': -20.0, 'AssetType': 'CfdOnIndex', 'CanBeClosed': True, 'ClientId': '17470793', 'CloseConversionRateSettled': False, 'CorrelationKey': '448cee99-656a-4b85-977a-24401f1d2ee3', 'ExecutionTimeOpen': '2023-07-30T22:00:00.212193Z', 'IsForceOpen': False, 'IsMarketOpen': True, 'LockedByBackOffice': False, 'OpenPrice': 15743.03, 'OpenPriceIncludingCosts': 15743.03, 'RelatedOpenOrders': [], 'SourceOrderId': '5014359516', 'Status': 'Open', 'Uic': 4912, 'ValueDate': '2023-07-31T00:00:00.000000Z'}, 'PositionId': '5016310271', 'PositionView': {'CalculationReliability': 'ApproximatedPrice', 'ConversionRateCurrent': 0.91704, 'ConversionRateOpen': 0.909335, 'CurrentPrice': 0.0, 'CurrentPriceDelayMinutes': 15, 'CurrentPriceType': 'None', 'Exposure': 0.0, 'ExposureCurrency': 'USD', 'ExposureInBaseCurrency': 0.0, 'InstrumentPriceDayPercentChange': 0.0, 'MarketState': 'Open', 'MarketValue': 0.0, 'MarketValueInBaseCurrency': 0.0, 'ProfitLossOnTrade': 10262.6, 'ProfitLossOnTradeInBaseCurrency': 9411.21, 'TradeCostsTotal': 0.0, 'TradeCostsTotalInBaseCurrency': 0.0, 'UnderlyingCurrentPrice': 0.0, 'ProfitLossOnTradeAdjusted': 10257.2}}, {'NetPositionId': '4913__CfdOnIndex', 'PositionBase': {'AccountId': '17470793', 'AccountKey': 'wlgQxI5-JzdhnV4s6BsDiA==', 'Amount': 20.0, 'AssetType': 'CfdOnIndex', 'CanBeClosed': True, 'ClientId': '17470793', 'CloseConversionRateSettled': False, 'CorrelationKey': 'd692dec4-f69d-4978-adf1-7f5dcc9e532e', 'ExecutionTimeOpen': '2023-07-30T22:00:00.203192Z', 'IsForceOpen': False, 'IsMarketOpen': True, 'LockedByBackOffice': False, 'OpenPrice': 4584.23, 'OpenPriceIncludingCosts': 4584.23, 'RelatedOpenOrders': [], 'SourceOrderId': '5014385511', 'Status': 'Open', 'Uic': 4913, 'ValueDate': '2023-07-31T00:00:00.000000Z'}, 'PositionId': '5016310265', 'PositionView': {'CalculationReliability': 'ApproximatedPrice', 'ConversionRateCurrent': 0.91704, 'ConversionRateOpen': 0.909335, 'CurrentPrice': 0.0, 'CurrentPriceDelayMinutes': 15, 'CurrentPriceType': 'None', 'Exposure': 0.0, 'ExposureCurrency': 'USD', 'ExposureInBaseCurrency': 0.0, 'InstrumentPriceDayPercentChange': 0.0, 'MarketState': 'Open', 'MarketValue': 0.0, 'MarketValueInBaseCurrency': 0.0, 'ProfitLossOnTrade': -1826.0, 'ProfitLossOnTradeInBaseCurrency': -1674.52, 'TradeCostsTotal': 0.0, 'TradeCostsTotalInBaseCurrency': 0.0, 'UnderlyingCurrentPrice': 0.0, 'ProfitLossOnTradeAdjusted': -1812.8}}, {'NetPositionId': '4913__CfdOnIndex', 'PositionBase': {'AccountId': '17470793', 'AccountKey': 'wlgQxI5-JzdhnV4s6BsDiA==', 'Amount': 20.0, 'AssetType': 'CfdOnIndex', 'CanBeClosed': True, 'ClientId': '17470793', 'CloseConversionRateSettled': False, 'CorrelationKey': '50c4933f-3029-40a6-9105-2c5f927dfb57', 'ExecutionTimeOpen': '2023-07-30T22:00:00.199193Z', 'IsForceOpen': False, 'IsMarketOpen': True, 'LockedByBackOffice': False, 'OpenPrice': 4584.23, 'OpenPriceIncludingCosts': 4584.23, 'RelatedOpenOrders': [], 'SourceOrderId': '5014382816', 'Status': 'Open', 'Uic': 4913, 'ValueDate': '2023-07-31T00:00:00.000000Z'}, 'PositionId': '5016310263', 'PositionView': {'CalculationReliability': 'ApproximatedPrice', 'ConversionRateCurrent': 0.91704, 'ConversionRateOpen': 0.909335, 'CurrentPrice': 0.0, 'CurrentPriceDelayMinutes': 15, 'CurrentPriceType': 'None', 'Exposure': 0.0, 'ExposureCurrency': 'USD', 'ExposureInBaseCurrency': 0.0, 'InstrumentPriceDayPercentChange': 0.0, 'MarketState': 'Open', 'MarketValue': 0.0, 'MarketValueInBaseCurrency': 0.0, 'ProfitLossOnTrade': -1826.0, 'ProfitLossOnTradeInBaseCurrency': -1674.52, 'TradeCostsTotal': 0.0, 'TradeCostsTotalInBaseCurrency': 0.0, 'UnderlyingCurrentPrice': 0.0, 'ProfitLossOnTradeAdjusted': -1812.6}}]},
    ]

    # TODO

